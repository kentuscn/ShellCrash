# HTTP(S) 代理端口
#port: 7890

# SOCKS5 代理端口
#socks-port: 7891

# HTTP(S) 和 SOCKS 代理混合端口
mixed-port: 7890

# Linux 和 macOS 的 redir 代理端口
# redir-port: 7892

# 是否允许局域网的连接（可用来共享代理）
allow-lan: true

bind-address: "*"

# 规则模式：rule（规则） / global（全局代理）/ direct（全局直连）/ script (脚本)
mode: rule

# 5 个级别：silent / error / warning / info / debug。从左至右级别依次递增，级别越高日志输出量越大
log-level: info

# 开启 IPv6 总开关，关闭阻断所有 IPv6 链接和屏蔽 DNS 请求 AAAA 记录
ipv6: true

# 更换延迟计算方式，去除握手等额外延迟
unified-delay: true

# RESTful API 监听地址
external-controller: :9090

# DNS 服务配置
dns:
  enable: true      # 是否启用dns 启用 true 禁用false
  prefer-h3: true   # 是否开启 DoH 支持 HTTP/3，将并发尝试
  use-hosts: true   # 是否查询配置中的 hosts，默认 true
  use-system-hosts: true   # 是否查询系统 hosts，默认 true
  respect-rules: false
  listen: 0.0.0.0:1053
  #ipv6: false

 # 用于解析 nameserver，fallback 以及其他 DNS 服务器配置的，DNS 服务域名
 # 只能使用纯 IP 地址，可使用加密 DNS
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
 # DNS 增强模式：可选值 normal / fake-ip / redir-host
 # 启用 fake-ip
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
 
 # fake ip 白名单列表，匹配到的将不适用 fake-ip
  fake-ip-filter:
    - '*.lan'
    - localhost.ptlogin2.qq.com
    - "*.msftconnecttest.com"
  
 # 默认的域名服务器，如不配置 fallback/proxy-server-nameserver，则所有域名都由 nameserver 解析
  nameserver:
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query
    #- https://223.5.5.5/dns-query    # 阿里 DOH
    #- https://1.12.12.12/dns-query   # 腾讯 DNSPod DOH
    #- tls://223.6.6.6:853            # 阿里 DOT
    #- 223.5.5.5                     # 阿里 IPv4
    #- 119.29.29.29                  # 腾讯 DNSPod

 # fallback 会查询 nameserver 中返回的 IP 是否为 CN，非必要配置
 # 当不是 CN，则使用 fallback 中的 DNS 解析
 # 解析墙外域名，推荐使用境外 DNS
  fallback:
    - tls://8.8.8.8
    - tls://1.0.0.1                                  # 延迟大
    - https://doh.dns.sb/dns-query                   # 延迟低 有丢包
    #- https://dns10.quad9.net/dns-query             # IBM DoH 无过滤 延迟140左右 无丢包
    #- https://dns.cloudflare.com/dns-query          # 延迟大
    #- tls://8.8.4.4                                 # 延迟大
    #- https://dns-unfiltered.adguard.com/dns-query  # AdGuard DoH 非过滤 延迟150左右 无丢包
    #- https://dns11.quad9.net/dns-query             # IBM DoH ECS保护 延迟190左右 无丢包
    #- https://doh.opendns.com/dns-query             # 延迟大 丢包严重

 # 专用于节点域名解析的 DNS 服务器，非必要配置项
  proxy-server-nameserver:
     - https://dns.alidns.com/dns-query
     - https://doh.pub/dns-query
    
 # 满足条件的直接使用 fallback DNS解析
  fallback-filter:
    geoip: true       # 是否启用 fallback filter
    geoip-code: CN    # geoip 库中 CN 的 IP 不使用 fallback DNS解析
    geosite:          # 匹配到 geosite 库中的 gfw 的内容将只使用 fallback DNS解析
      - gfw
    ipcidr:           # 匹配到这些网段的 IP 直接使用 fallback DNS解析
      - 240.0.0.0/4
      - 0.0.0.0/32
      - 127.0.0.1/32
      
  # 匹配到这些域名，会直接使用 fallback解析
    domain:
      - '+.google.com'
      - '+.facebook.com'
      - '+.youtube.com'
